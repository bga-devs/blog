<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="Getting the database out of the stone age" /><meta name="author" content="Guillaume Benny" /><meta property="og:locale" content="en" /><meta name="description" content="See what I did there? Stone Age? OK, sorry about that." /><meta property="og:description" content="See what I did there? Stone Age? OK, sorry about that." /><link rel="canonical" href="https://bga-devs.github.io/blog/blog/posts/stone-age-db/" /><meta property="og:url" content="https://bga-devs.github.io/blog/blog/posts/stone-age-db/" /><meta property="og:site_name" content="BGA Developers" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-04-06T14:00:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Getting the database out of the stone age" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"Guillaume Benny"},"description":"See what I did there? Stone Age? OK, sorry about that.","url":"https://bga-devs.github.io/blog/blog/posts/stone-age-db/","@type":"BlogPosting","headline":"Getting the database out of the stone age","dateModified":"2022-04-09T20:35:40+02:00","datePublished":"2022-04-06T14:00:00+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://bga-devs.github.io/blog/blog/posts/stone-age-db/"},"@context":"https://schema.org"}</script><title>Getting the database out of the stone age | BGA Developers</title><link rel="apple-touch-icon" sizes="180x180" href="/blog/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/blog/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/blog/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/blog/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/blog/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="BGA Developers"><meta name="application-name" content="BGA Developers"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/blog/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/blog/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/blog/" alt="avatar" class="mx-auto"> <img src="/blog/assets/img/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/blog/">BGA Developers</a></div><div class="site-subtitle font-italic">The tales of BGA game development</div></div><ul class="w-100"><li class="nav-item"> <a href="/blog/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/blog/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/blog/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/blog/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/blog/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/bga-devs" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['tim.pecatte','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/blog/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/blog/"> Home </a> </span> <span>Getting the database out of the stone age</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Getting the database out of the stone age</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Guillaume Benny </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Wed, Apr 6, 2022, 2:00 PM +0200" >Apr 6<i class="unloaded">2022-04-06T14:00:00+02:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Sat, Apr 9, 2022, 2:35 PM -0400" >Apr 9<i class="unloaded">2022-04-09T20:35:40+02:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1624 words">9 min read</span></div></div><div class="post-content"><p><em>See what I did there? <a href="https://boardgamearena.com/gamepanel?game=stoneage">Stone Age</a>? OK, sorry about that.</em></p><p>BGA’s database layer is… old. Writting database requests by hand is tedious and prone to errors.</p><p><img data-proofer-ignore data-src="/blog/assets/img/stone-age-db/stone-age.jpg" alt="Stone age: Typing SQL queries by hand" width="400" /></p><p>So after developing 2 games on BGA, I understood enough of the framework to build my own library on top of what is provided.</p><p>And the first thing on my todo list: a better database layer!</p><p>Let’s start with a simple table named <code class="language-plaintext highlighter-rouge">shape</code>:</p><div class="language-php highlighter-rouge"><div class="code-header"> <span text-data=" PHP "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">getObjectListFromDB</span><span class="p">(</span>
    <span class="s2">"SELECT shape_id, shape_type_id, player_id FROM shape"</span>
<span class="p">);</span>
</pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">shape_id</code> is a unique id for the shape.<li><code class="language-plaintext highlighter-rouge">shape_type_id</code> is a number. 0 is a triangle, 1 is a square and 2 is an hexagon.<li><code class="language-plaintext highlighter-rouge">player_id</code> is the player that owns the shape. It’s <code class="language-plaintext highlighter-rouge">NULL</code> if the shape is in the general supply.</ul><p>We would like to be able to read each rows in a class like this:</p><div class="language-php highlighter-rouge"><div class="code-header"> <span text-data=" PHP "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">Shape</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$shape_id</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$shape_type_id</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$player_id</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>We need to be able to match columns with the class properties and also know which property is the primary key of the table. There are many ways to do that but let’s look at <em>annotations</em>.</p><h2 id="annotations--attributes">Annotations / Attributes</h2><p>PHP 8 adds <em>attributes</em> (called <em>annotations</em> in other languages) which could be very useful here… but right now we are stuck with PHP 7.4. But all is not lost since we can use <em>Doc comments</em> to implement something similar. Our class will look like this:</p><div class="language-php highlighter-rouge"><div class="code-header"> <span text-data=" PHP "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">Shape</span>
<span class="p">{</span>
    <span class="cd">/** @dbcol @dbkey */</span>
    <span class="k">public</span> <span class="nv">$shape_id</span><span class="p">;</span>
    <span class="cd">/** @dbcol */</span>
    <span class="k">public</span> <span class="nv">$shape_type_id</span><span class="p">;</span>
    <span class="cd">/** @dbcol */</span>
    <span class="k">public</span> <span class="nv">$player_id</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Note the double stars at the start of the comments: this normally indicates to PHP that this comment should be extracted to generate documentation. But we will use this to implement annotations. (This is not my idea, there are existing libraries that do this too.)</p><p>Here’s how it works:</p><div class="language-php highlighter-rouge"><div class="code-header"> <span text-data=" PHP "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nv">$reflect</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ReflectionClass</span><span class="p">(</span><span class="nc">Shape</span><span class="o">::</span><span class="n">class</span><span class="p">);</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$reflect</span><span class="o">-&gt;</span><span class="nf">getProperties</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$property</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$name</span> <span class="o">=</span> <span class="nv">$property</span><span class="o">-&gt;</span><span class="nf">getName</span><span class="p">();</span>
    <span class="nv">$doc</span> <span class="o">=</span> <span class="nv">$property</span><span class="o">-&gt;</span><span class="nf">getDocComment</span><span class="p">();</span>
    <span class="k">echo</span><span class="p">(</span><span class="s2">"</span><span class="nv">$name</span><span class="s2">: </span><span class="nv">$doc</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>And the output will look like this:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>shape_id: /** @dbcol @dbkey */
shape_type_id: /** @dbcol */
player_id: /** @dbcol */
</pre></table></code></div></div><p>We use PHP’s <a href="https://www.php.net/manual/en/book.reflection.php">ReflectionClass</a> to list properties and get their <em>doc comment</em>. This class has other very useful methods when you need to inspect the internals of classes.</p><p>With that, we only need to parse those comments to know which properties are database columns and which are also the primary key(s) of the table. We’ll leave the parsing out of this blog post, but see the end for a link to the full implementation.</p><p><img data-proofer-ignore data-src="/blog/assets/img/stone-age-db/parsing.gif" alt="Parsing" width="300" /></p><h2 id="generating-select">Generating SELECT</h2><p>Generating a <code class="language-plaintext highlighter-rouge">SELECT</code> is now easy:</p><div class="language-php highlighter-rouge"><div class="code-header"> <span text-data=" PHP "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nv">$dbColumns</span> <span class="o">=</span> <span class="nb">implode</span><span class="p">(</span><span class="s1">','</span><span class="p">,</span> <span class="nb">array_map</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$p</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// We would need to filter to take only the @dbcol annotations</span>
    <span class="k">return</span> <span class="nv">$p</span><span class="o">-&gt;</span><span class="nf">getName</span><span class="p">();</span>
<span class="p">},</span> <span class="nv">$reflect</span><span class="o">-&gt;</span><span class="nf">getProperties</span><span class="p">()));</span>

<span class="nv">$sql</span> <span class="o">=</span> <span class="s2">"SELECT </span><span class="nv">$dbColumns</span><span class="s2"> FROM shape"</span><span class="p">;</span>
<span class="k">echo</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<span class="c1">// Output:</span>
<span class="c1">// SELECT shape_id,shape_type_id,player_id FROM shape</span>
</pre></table></code></div></div><h2 id="generating-update-insert-and-delete">Generating UPDATE, INSERT and DELETE</h2><p>Generating an <code class="language-plaintext highlighter-rouge">UPDATE</code> from a <code class="language-plaintext highlighter-rouge">Shape</code> instance requires a little helper to properly format values for SQL:</p><div class="language-php highlighter-rouge"><div class="code-header"> <span text-data=" PHP "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="k">function</span> <span class="n">sqlNullOrValue</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$value</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s2">"NULL"</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">is_string</span><span class="p">(</span><span class="nv">$value</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s2">"'"</span> <span class="mf">.</span> <span class="nb">addslashes</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span> <span class="mf">.</span> <span class="s2">"'"</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">is_bool</span><span class="p">(</span><span class="nv">$value</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="nv">$value</span> <span class="o">?</span> <span class="s2">"1"</span> <span class="o">:</span> <span class="s2">"0"</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s2">"</span><span class="nv">$value</span><span class="s2">"</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>With that, we can generate the <code class="language-plaintext highlighter-rouge">UPDATE</code>:</p><div class="language-php highlighter-rouge"><div class="code-header"> <span text-data=" PHP "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="nv">$row</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Shape</span><span class="p">();</span>
<span class="nv">$row</span><span class="o">-&gt;</span><span class="n">shape_id</span> <span class="o">=</span> <span class="mi">123</span><span class="p">;</span>
<span class="nv">$row</span><span class="o">-&gt;</span><span class="n">shape_type_id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// A square!</span>
<span class="nv">$row</span><span class="o">-&gt;</span><span class="n">player_id</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

<span class="nv">$dbValues</span> <span class="o">=</span> <span class="nb">implode</span><span class="p">(</span><span class="s1">', '</span><span class="p">,</span> <span class="nb">array_map</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$p</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$row</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// We would need to filter to take only the @dbcol annotations</span>
    <span class="k">return</span> <span class="nv">$p</span><span class="o">-&gt;</span><span class="nf">getName</span><span class="p">()</span> <span class="mf">.</span> <span class="s2">" = "</span> <span class="mf">.</span> <span class="nf">sqlNullOrValue</span><span class="p">(</span><span class="nv">$p</span><span class="o">-&gt;</span><span class="nf">getValue</span><span class="p">(</span><span class="nv">$row</span><span class="p">));</span>
<span class="p">},</span> <span class="nv">$reflect</span><span class="o">-&gt;</span><span class="nf">getProperties</span><span class="p">()));</span>

<span class="nv">$dbKeys</span> <span class="o">=</span> <span class="nb">implode</span><span class="p">(</span><span class="s1">' AND '</span><span class="p">,</span> <span class="nb">array_map</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$p</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$row</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// We would need to filter to take only the @dbkey annotations</span>
    <span class="k">return</span> <span class="nv">$p</span><span class="o">-&gt;</span><span class="nf">getName</span><span class="p">()</span> <span class="mf">.</span> <span class="s2">" = "</span> <span class="mf">.</span> <span class="nf">sqlNullOrValue</span><span class="p">(</span><span class="nv">$p</span><span class="o">-&gt;</span><span class="nf">getValue</span><span class="p">(</span><span class="nv">$row</span><span class="p">));</span>
<span class="p">},</span> <span class="nv">$reflect</span><span class="o">-&gt;</span><span class="nf">getProperties</span><span class="p">()));</span>

<span class="nv">$sql</span> <span class="o">=</span> <span class="s2">"UPDATE shape SET </span><span class="nv">$dbValues</span><span class="s2"> WHERE </span><span class="nv">$dbKeys</span><span class="s2">"</span><span class="p">;</span>
<span class="k">echo</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<span class="c1">// Output (if it was properly filtered):</span>
<span class="c1">// UPDATE shape SET shape_id = 123, shape_type_id = 1, player_id = NULL WHERE shape_id = 123</span>
</pre></table></code></div></div><p>Finally, generating an <code class="language-plaintext highlighter-rouge">INSERT</code> or a <code class="language-plaintext highlighter-rouge">DELETE</code> is pretty much the same.</p><h2 id="wrapping-everything-in-a-manager-class">Wrapping everything in a manager class</h2><p><img data-proofer-ignore data-src="/blog/assets/img/stone-age-db/manager.jpg" alt="Look at me, I'm the manager now" width="300" /></p><p>We can now take everything a wrap it in a nice class:</p><div class="language-php highlighter-rouge"><div class="code-header"> <span text-data=" PHP "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre><td class="rouge-code"><pre><span class="c1">// APP_DbObject allows us to call BGA database functions</span>
<span class="kd">class</span> <span class="nc">RowManager</span> <span class="kd">extends</span> <span class="nc">APP_DbObject</span>
<span class="p">{</span>
    <span class="c1">// ... private members ...</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">__construct</span><span class="p">(</span><span class="kt">string</span> <span class="nv">$tableName</span><span class="p">,</span> <span class="kt">string</span> <span class="nv">$baseRowClassName</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// ... keep those parameters in private members ...</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">insertRow</span><span class="p">(</span><span class="nv">$row</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Generate INSERT and call $this-&gt;DBQuery($sql)</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">updateRow</span><span class="p">(</span><span class="kt">BaseRow</span> <span class="nv">$row</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Generate UPDATE and call $this-&gt;DBQuery($sql)</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">deleteRow</span><span class="p">(</span><span class="kt">BaseRow</span> <span class="nv">$row</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Generate DELETE and call $this-&gt;DBQuery($sql)</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">getAllRows</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$sql</span> <span class="o">=</span> <span class="c1">// Generate SELECT</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">getObjectListFromDB</span><span class="p">(</span><span class="nv">$sql</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$row</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$rowObject</span> <span class="o">=</span> <span class="k">new</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">baseClassRowName</span><span class="p">;</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="nv">$row</span> <span class="k">as</span> <span class="nv">$property</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$rowObject</span><span class="o">-&gt;</span><span class="nv">$property</span> <span class="o">=</span> <span class="nv">$value</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="c1">// $rowObject properties are now initialised. Keep all</span>
            <span class="c1">// those objets in an array to return them all.</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>We can use our new manager it like this:</p><div class="language-php highlighter-rouge"><div class="code-header"> <span text-data=" PHP "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nv">$row</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Shape</span><span class="p">();</span>
<span class="nv">$row</span><span class="o">-&gt;</span><span class="n">shape_id</span> <span class="o">=</span> <span class="mi">123</span><span class="p">;</span>
<span class="nv">$row</span><span class="o">-&gt;</span><span class="n">shape_type_id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// A square!</span>
<span class="nv">$row</span><span class="o">-&gt;</span><span class="n">player_id</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

<span class="nv">$manager</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RowManager</span><span class="p">(</span><span class="s1">'shape'</span><span class="p">,</span> <span class="nc">Shape</span><span class="o">::</span><span class="n">class</span><span class="p">);</span>
<span class="nv">$manager</span><span class="o">-&gt;</span><span class="nf">insertRow</span><span class="p">(</span><span class="nv">$row</span><span class="p">);</span>

<span class="nv">$manager</span><span class="o">-&gt;</span><span class="nf">getAllRows</span><span class="p">();</span> <span class="c1">// Returns an array of Shape instances</span>
</pre></table></code></div></div><p>Success!</p><p><img data-proofer-ignore data-src="/blog/assets/img/stone-age-db/success.jpg" alt="Great success" width="300" /></p><p>… But we can do much better now that we got a working database manager.</p><h2 id="the-case-of-shape_type_id">The case of shape_type_id</h2><p>The fact that <code class="language-plaintext highlighter-rouge">shape_type_id</code> is a integer means that we need to write code like this:</p><div class="language-php highlighter-rouge"><div class="code-header"> <span text-data=" PHP "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">Shape</span> 
<span class="p">{</span>
    <span class="c1">// ... Properties ...</span>

    <span class="c1">// Not the best example but you get the idea</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">countSides</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">switch</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">shape_type_id</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
                <span class="k">return</span> <span class="mi">3</span><span class="p">;</span>
            <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
                <span class="k">return</span> <span class="mi">4</span><span class="p">;</span>
            <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
                <span class="k">return</span> <span class="mi">6</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nc">BgaSystemException</span><span class="p">(</span><span class="s2">"Unknown shape_type_id!"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>This is not very nice, especially if you have multiple functions and you need to add a new shape type! Let’s try to change how <code class="language-plaintext highlighter-rouge">Shape</code> is defined:</p><div class="language-php highlighter-rouge"><div class="code-header"> <span text-data=" PHP "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre><td class="rouge-code"><pre><span class="k">abstract</span> <span class="kd">class</span> <span class="nc">Shape</span>
<span class="p">{</span>
    <span class="cd">/** @dbcol @dbkey */</span>
    <span class="k">public</span> <span class="nv">$shape_id</span><span class="p">;</span>
    <span class="c1">// NOTE THE CHANGE ON THE NEXT 2 LINES</span>
    <span class="cd">/** @dbcol @dbclassid */</span>
    <span class="k">public</span> <span class="nv">$class_id</span><span class="p">;</span>
    <span class="cd">/** @dbcol */</span>
    <span class="k">public</span> <span class="nv">$player_id</span><span class="p">;</span>

    <span class="k">abstract</span> <span class="k">public</span> <span class="k">function</span> <span class="n">countSides</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">Triangle</span> <span class="kd">extends</span> <span class="nc">Shape</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">countSides</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="mi">3</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">Square</span> <span class="kd">extends</span> <span class="nc">Shape</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">countSides</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="mi">4</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">Hexagon</span> <span class="kd">extends</span> <span class="nc">Shape</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">countSides</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="mi">6</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

</pre></table></code></div></div><p>Much better! In the database, <code class="language-plaintext highlighter-rouge">class_id</code> must be a (long enough) varchar. But how to get our database manager to understand this?</p><div class="language-php highlighter-rouge"><div class="code-header"> <span text-data=" PHP "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">RowManager</span> <span class="kd">extends</span> <span class="nc">APP_DbObject</span>
<span class="p">{</span>
    <span class="c1">// No change to constructor</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">insertRow</span><span class="p">(</span><span class="nv">$row</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// We must now do this:</span>
        <span class="nv">$propertyClassId</span> <span class="o">=</span> <span class="c1">// Get property with @dbclassid, so 'class_id' in our case</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$propertyClassId</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// get_class will return the real class as</span>
            <span class="c1">// a string, so 'Triangle', 'Square' or 'Hexagon'</span>
            <span class="nv">$row</span><span class="o">-&gt;</span><span class="nv">$propertyClassId</span> <span class="o">=</span> <span class="nb">get_class</span><span class="p">(</span><span class="nv">$row</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="c1">// Generate INSERT and call $this-&gt;DBQuery($sql)</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">updateRow</span><span class="p">(</span><span class="kt">BaseRow</span> <span class="nv">$row</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// We do the same thing to update the property with @dbclassid</span>
        <span class="c1">// Generate UPDATE and call $this-&gt;DBQuery($sql)</span>
    <span class="p">}</span>

    <span class="c1">// No change for deleteRow</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">getAllRows</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$sql</span> <span class="o">=</span> <span class="c1">// Generate SELECT</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">getObjectListFromDB</span><span class="p">(</span><span class="nv">$sql</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$row</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$classId</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">baseClassRowName</span><span class="p">;</span>
            <span class="nv">$propertyClassId</span> <span class="o">=</span> <span class="c1">// Get property with @dbclassid, so 'class_id' in our case</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$propertyClassId</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$classId</span> <span class="o">=</span> <span class="nv">$row</span><span class="p">[</span><span class="nv">$propertyClassId</span><span class="p">];</span>
            <span class="p">}</span>
            <span class="c1">// PHP can create class if you have their name in a string</span>
            <span class="nv">$rowObject</span> <span class="o">=</span> <span class="k">new</span> <span class="nv">$classId</span><span class="p">;</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="nv">$row</span> <span class="k">as</span> <span class="nv">$property</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$rowObject</span><span class="o">-&gt;</span><span class="nv">$property</span> <span class="o">=</span> <span class="nv">$value</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="c1">// $rowObject properties are now initialised. Keep all</span>
            <span class="c1">// those objets in an array to return them all.</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>We can now create shapes and save them:</p><div class="language-php highlighter-rouge"><div class="code-header"> <span text-data=" PHP "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="nv">$row1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Square</span><span class="p">();</span>
<span class="nv">$row1</span><span class="o">-&gt;</span><span class="n">shape_id</span> <span class="o">=</span> <span class="mi">123</span><span class="p">;</span>
<span class="nv">$row1</span><span class="o">-&gt;</span><span class="n">player_id</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

<span class="nv">$row2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Triangle</span><span class="p">();</span>
<span class="nv">$row2</span><span class="o">-&gt;</span><span class="n">shape_id</span> <span class="o">=</span> <span class="mi">456</span><span class="p">;</span>
<span class="nv">$row2</span><span class="o">-&gt;</span><span class="n">player_id</span> <span class="o">=</span> <span class="mi">67890123</span><span class="p">;</span>


<span class="nv">$manager</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RowManager</span><span class="p">(</span><span class="s1">'shape'</span><span class="p">,</span> <span class="nc">Shape</span><span class="o">::</span><span class="n">class</span><span class="p">);</span>
<span class="nv">$manager</span><span class="o">-&gt;</span><span class="nf">insertRow</span><span class="p">(</span><span class="nv">$row1</span><span class="p">);</span>
<span class="nv">$manager</span><span class="o">-&gt;</span><span class="nf">insertRow</span><span class="p">(</span><span class="nv">$row2</span><span class="p">);</span>

<span class="nv">$manager</span><span class="o">-&gt;</span><span class="nf">getAllRows</span><span class="p">();</span> <span class="c1">// Returns [Square, Triangle]</span>
</pre></table></code></div></div><p>Note that unlike real inheritance, all the properties must be in the base class since we only have one table.</p><h2 id="and-thats-not-all">And that’s not all!</h2><p><img data-proofer-ignore data-src="/blog/assets/img/stone-age-db/but-wait-thats-not-all.jpg" alt="But wait, that's not all" width="300" /></p><p>This post is only a part of what you can do! For example, in my implementation, I support the annotation <code class="language-plaintext highlighter-rouge">@dbautoincrement</code> to indicate that the column is autoincrement in the database so that the library can read the new value from the database when inserting. I also prefer my database columns to be <code class="language-plaintext highlighter-rouge">snake_case</code> (like <code class="language-plaintext highlighter-rouge">shape_id</code>) while in PHP they are <code class="language-plaintext highlighter-rouge">camelCase</code> (like <code class="language-plaintext highlighter-rouge">$shapeId</code>) so I do this conversion too. And so much more!</p><p>If you want to see more of the database library, you can look at the implementation in <a href="https://github.com/bennygui/barenpark-public/blob/main/modules/php/BX/DB.php">DB.php</a>. The annotation library (and more reflection-related functions) is in another file: <a href="https://github.com/bennygui/barenpark-public/blob/main/modules/php/BX/Meta.php">Meta.php</a>.</p><p>Hopefully, next time we’ll talk about what we can build on top of that database manager. Until next time, have fun!</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/blog/categories/tips/'>Tips</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/blog/tags/back/" class="post-tag no-text-decoration" >back</a> <a href="/blog/tags/class/" class="post-tag no-text-decoration" >class</a> <a href="/blog/tags/database/" class="post-tag no-text-decoration" >database</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Getting the database out of the stone age - BGA Developers&url=https://bga-devs.github.io/blog/blog/posts/stone-age-db/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Getting the database out of the stone age - BGA Developers&u=https://bga-devs.github.io/blog/blog/posts/stone-age-db/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Getting the database out of the stone age - BGA Developers&url=https://bga-devs.github.io/blog/blog/posts/stone-age-db/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/blog/posts/stone-age-db/">Getting the database out of the stone age</a><li><a href="/blog/posts/why-use-typescript/">Why (I) use TypeScript</a><li><a href="/blog/posts/class-notif/">Classes, notifications and bugs!</a><li><a href="/blog/posts/a-real-fast-replay-mode/">How to make a real fast replay mode</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/blog/tags/back/">back</a> <a class="post-tag" href="/blog/tags/front/">front</a> <a class="post-tag" href="/blog/tags/class/">class</a> <a class="post-tag" href="/blog/tags/debug/">debug</a> <a class="post-tag" href="/blog/tags/database/">database</a> <a class="post-tag" href="/blog/tags/replay/">replay</a> <a class="post-tag" href="/blog/tags/css/">css</a> <a class="post-tag" href="/blog/tags/notification/">notification</a> <a class="post-tag" href="/blog/tags/translation/">translation</a> <a class="post-tag" href="/blog/tags/typescript/">typescript</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/blog/posts/do-the-undo/"><div class="card-body"> <span class="timeago small" >Apr 27<i class="unloaded">2022-04-27T14:00:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Do the undo &mdash; The search for an undo system</h3><div class="text-muted small"><p> Let’s talk about undoing. BGA has an undo system but it has limitations: You only have one undo. If you have a multi-step action, undoing means restarting from the beginning. The undo system...</p></div></div></a></div><div class="card"> <a href="/blog/posts/class-notif/"><div class="card-body"> <span class="timeago small" >Nov 25, 2021<i class="unloaded">2021-11-25T14:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Classes, notifications and bugs!</h3><div class="text-muted small"><p> When creating a game, you will probably want to create classes so that your code doesn’t become a mess. Something like this: class Card { public $cardId; public $locationId; public $pl...</p></div></div></a></div><div class="card"> <a href="/blog/posts/translations-summary/"><div class="card-body"> <span class="timeago small" >Nov 28, 2021<i class="unloaded">2021-11-28T11:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Translations - a recap</h3><div class="text-muted small"><p> As I usually say on the discord server for BGA developpers, translations are easy and hard. Hard because translations seems to be one of the most recurring issue developpers are facing on BGA, even...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/blog/posts/why-use-typescript/" class="btn btn-outline-primary" prompt="Older"><p>Why (I) use TypeScript</p></a> <a href="/blog/posts/stuck-with-stock/" class="btn btn-outline-primary" prompt="Newer"><p>Stuck with Stock?</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://bga-devs.github.io/blog/blog/posts/stone-age-db/'; this.page.identifier = '/posts/stone-age-db/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://bga-devs-blog.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (modeToggle !== null) { modeToggle.addEventListener('click', reloadDisqus); window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/Syarwin">Timothée Pecatte</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/blog/tags/back/">back</a> <a class="post-tag" href="/blog/tags/front/">front</a> <a class="post-tag" href="/blog/tags/class/">class</a> <a class="post-tag" href="/blog/tags/debug/">debug</a> <a class="post-tag" href="/blog/tags/database/">database</a> <a class="post-tag" href="/blog/tags/replay/">replay</a> <a class="post-tag" href="/blog/tags/css/">css</a> <a class="post-tag" href="/blog/tags/notification/">notification</a> <a class="post-tag" href="/blog/tags/translation/">translation</a> <a class="post-tag" href="/blog/tags/typescript/">typescript</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/blog/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/blog/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/blog/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
